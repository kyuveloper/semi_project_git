<!DOCTYPE html>
<!-- thymeleaf 프라그먼트 -->
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layout/default_layout">
<th:block layout:fragment="content">

    <div class="bookmark_list_div">
        <div class="bookmark_div" th:each="bookmark, iterStat : ${bookmark}">
            <p th:text="${bookmark.companyCtprvn}"></p>
            <p th:text="${bookmark.companyName}"></p>
            <p th:text="${bookmark.companyClassi}"></p>
            <button class="addBookmarkButton" th:data-bookmark-id="${bookmark.bookmarkCode}">추가</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var addButtonList = document.querySelectorAll('.addBookmarkButton');

            addButtonList.forEach(function (button) {
                button.addEventListener('click', function (event) {
                    var bookmarkCode = event.target.dataset.bookmarkId;

                    // 서버에 데이터 전송
                    fetch('/api/insert_mapping', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ bookmarkCode: bookmarkCode }),
                    })
                        .then(response => response.json())
                        .then(result => {
                            // 서버로부터의 응답 처리
                            if (result < 0) {
                                console.log('실패');
                            } else {
                                console.log('성공');
                                location.reload();
                            }
                        })
                        .catch(error => {
                            console.error('에러 발생:', error);
                        });
                });
            });
        });
    </script>

    <div th:each="detailPlan:${detailPlan}">
        <p th:text="${detailPlan.companyName}"></p>
    </div>

</th:block>
</html>