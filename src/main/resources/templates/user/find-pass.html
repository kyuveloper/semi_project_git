<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://kit.fontawesome.com/e8f09b5de5.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link rel="stylesheet" th:href="@{/css/style.css}"/>
    <link rel="stylesheet" th:href="@{/css/user.css}"/>
    <link rel="stylesheet" th:href="@{/css/comInfo.css}" />
    <script defer th:src="@{/js/main.js}"></script>
    <script defer th:src="@{/js/comInfo.js}"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>
    <title>Semi Project Company Information</title>
</head>
<body>
<header id="header_bar">

    <nav id="nav_bar">
        <div class="main_title">
            <a th:href="@{/}"><i class="fa-solid fa-dog"></i> PetTales</a>
        </div>
        <div class="main_menus">
            <div class="main_menu"><a th:href="@{/}">Home</a></div>
            <div class="main_menu"><a th:href="@{/comInfo}">Start</a></div>
            <div class="main_menu"><a th:href="@{/plan/make_plan}">Support</a></div>
        </div>
        <div class="main_mypage">
            <a href="#"><i class="fa-solid fa-user" style="color: #ffffff;"></i></a>
        </div>
    </nav>
</header>
<article>
    <div class="myPage_box">
        <ul class="myPage_menus">
            <li sec:authorize="!hasAnyAuthority('ADMIN','USER')" class="myPage_menu"><a th:href="@{/auth/login}">로그인</a></li>
            <li sec:authorize="!hasAnyAuthority('ADMIN','USER')" class="myPage_menu"><a th:href="@{/user/signup}">회원가입</a></li>
            <li sec:authorize="hasAnyAuthority('ADMIN')" class="myPage_menu"><a th:href="@{/admin/userstatus}">관리자 페이지</a></li>
            <li sec:authorize="hasAnyAuthority('ADMIN','USER')" class="myPage_menu">마이페이지</li>
            <li sec:authorize="hasAnyAuthority('ADMIN','USER')" class="myPage_menu"><a th:href="@{/auth/logout}">로그아웃</a></li>
        </ul>
    </div>
</article>

<!--회원가입시 문제를 내서 거기에 대한 답을 적고 비밀번호 찾기때 유저 이메일과 답이 일치할 시 비밀번호 변경 페이지로 넘어감-->
<form th:action="@{/user/find-pass}" th:method="POST">
    <div class="find-back-block">
    <h2>비밀번호 찾기</h2>
    <div class="signUpEmailDiv">
    <p><img th:src="@{/image/signup/emailLogo.png}">
        <input type="email" name="userEmail" placeholder="이메일" id="userEmail" size="60"></p>
    </div>
        <div class="findPassCheck">
            <p><img th:src="@{/image/signup/questionMark.png}">
                <input type="text" name="answer" placeholder="본인의 고등학교 이름은?" id="answer" size="60">
            <button type="button" onclick="checkAnswer()">확인</button></p>
        </div>
        <div class="center">
            <p><small>답변이 일치해야 비밀번호를 입력할 수 있습니다.</small></p>
        </div>

        <!--새 비밀번호 입력-->
        <div class="passwordDiv">
            <p><img th:src="@{/image/signup/passLogo.jpg}">
                <input type="password" name="password" placeholder="새 비밀번호" id="password" size="60" disabled></p>
        </div>
        <div class="center">
            <p><small>비밀번호는 6~16자리수여야 합니다. 영문 소문자, 숫자, 특수문자를 1개 이상 포함해야 합니다.</small></p>
        </div>

        <!--새 비밀번호 확인-->
        <div class="findPassCheck">
            <p><img th:src="@{/image/signup/passLogo.jpg}">
                <input type="password" name="newCheckPassword" placeholder="새 비밀번호 확인" id="password2" size="60" disabled>
                <button type="button" onclick="newPassCheck()">확인</button></p>
        </div>

        <div class="findPass">
            <button>변경하기</button>
        </div>
    </div>
</form>
<footer>
    <div id="footer">
        <div class="comInfo">
            <div class="comLogo"><i class="fa-solid fa-dog"></i></div>
            <div class="comInfo_text">
                <p>
                    주식회사 위드명 | 대표 김아무개<br>
                    사업자 등록 번호 123-456-78910<br>
                    서울특별시 구로구 경인로 557 삼영빌딩 4층<br>
                    contact@withmung.com<br>
                </p>
            </div>
        </div>
        <div class="etc">
            <p>
                <a href="">이용약관</a> | <a href="">개인정보처리지침</a> | <a href="">고객지원</a> | <a href="">1:1 문의</a>
            </p>
        </div>
        <div class="sns">
            <a th:href="@{http://www.facebook.com}" target="_blank"><i class="fa-brands fa-square-facebook fa-fade"></i></a>
            <a th:href="@{http://www.instagram.com}" target="_blank"><i class="fa-brands fa-instagram fa-fade"></i></a>
            <a th:href="@{http://www.youtube.com}" target="_blank"><i class="fa-brands fa-youtube fa-fade"></i></a>
        </div>
    </div>
</footer>
</body>
<script>
    const checkAnswer = () => {
        const userEmail = document.getElementById("userEmail").value;
        const answer = document.getElementById("answer").value;

        console.log("입력한 이메일", userEmail + "입력한 답", answer);
        $.ajax({
            type: "post",
            url: "/user/check-answer",
            data: {
                "userEmail": userEmail,
                "answer": answer
            },
            success: function (res) {
                console.log("요청성공", res);
                if (res === 1) {
                    console.log("답변이 일치합니다");
                    // 비밀번호 입력란과 확인란 활성화
                    document.getElementById("password").disabled = false;
                    document.getElementById("password2").disabled = false;
                    alert("답변이 일치합니다.");
                } else {
                    console.log("답변이 일치하지 않습니다");
                    alert("답변이 일치하지 않습니다.");
                }
            },
            error: function (err) {
                console.log("에러발생", err);
            }
        });
    }

    function newPassCheck(){
        var v1 = document.getElementById('password').value;
        var v2 = document.getElementById('password2').value;
        console.log(v1, v2)
        if(v1 != v2) {
            alert("비밀번호가 일치하지 않습니다");
            return false;
        } else {
            alert("비밀번호가 일치합니다");
            return true;
        }
    }
</script>
</html>