<!DOCTYPE html>
<html lang="en">
<head>
  <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=z00qc7owtc"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<h1>hi</h1>
<section>
  <h3>메뉴판</h3>
</section>
<table>
  <div id="map" style="width: 500px; height: 500px">
    <script th:inline="javascript">
      navigator.geolocation.getCurrentPosition((position) => {
        /* 위도 경도 변수에 담기 */
        latitude = position.coords.latitude;
        longitude = position.coords.longitude;

        /* 다중 마커와 정보 함수 표현 (제이쿼리) */
        $(function() {
          initMap();
        });
        function initMap() {
          // 자바스크립트에서 타임이프 문법 사용
          /*<![CDATA[*/
          const areaArr = new Array();
          /*[# th:each="lct : ${locations}"]*/
          areaArr.push(
                  {
                    information: [[${lct.companyName}]],
                    lat: [[${lct.companyLat}]],
                    lng: [[${lct.companyHar}]]
                  })
          console.log(areaArr)
          /*[/]*/
          /*]]>*/
          // 자바스크립트에서 타임이프 문법 사용(여기까지)

          let markers = new Array(); // 마커 정보를 담는 배열
          let infoWindows = new Array(); // 정보창을 담는 배열

          //지도 시작 지점
          var map = new naver.maps.Map('map', {
            center: new naver.maps.LatLng(latitude, longitude),
            zoom: 13,
            mapTypeControl: true
          });

          for (var i = 0; i < areaArr.length; i++) {
            // 지역을 담은 배열의 길이만큼 for문으로 마커와 정보창을 채워주자

            var marker = new naver.maps.Marker({
              map: map,
              title: areaArr[i].information, // 지역구 이름
              position: new naver.maps.LatLng(areaArr[i].lat , areaArr[i].lng) // 지역구의 위도 경도 넣기
            });

            // if (true) {
            //     marker.style.display = 'none';
            // }

            /* 정보창 */
            var infoWindow = new naver.maps.InfoWindow({
              content: '<div style="width:200px;text-align:center;padding:10px;"><b>' + areaArr[i].information + '</b><br> - 네이버 지도 - </div>'
            }); // 클릭했을 때 띄워줄 정보 HTML 작성

            markers.push(marker); // 생성한 마커를 배열에 담는다.
            infoWindows.push(infoWindow); // 생성한 정보창을 배열에 담는다.


          }

          function getClickHandler(seq) {

            return function (e) {  // 마커를 클릭하는 부분
              var marker = markers[seq], // 클릭한 마커의 시퀀스로 찾는다.
                      infoWindow = infoWindows[seq]; // 클릭한 마커의 시퀀스로 찾는다

              if (infoWindow.getMap()) {
                infoWindow.close();
              } else {
                infoWindow.open(map, marker); // 표출
              }
            }
          }
          for (var i=0, ii=markers.length; i<ii; i++) {
            naver.maps.Event.addListener(markers[i], 'click', getClickHandler(i)); // 클릭한 마커 핸들러
          }

          /* (좌측상단 버튼) 내위치로 지도 이동 */
          var locationBtnHtml = '<a href="#" class="mapBtn"><span class="mapBtnText">내 위치로</span></a>';

          var customControl = new naver.maps.CustomControl(locationBtnHtml, {
            position: naver.maps.Position.TOP_LEFT
          });

          naver.maps.Event.once(map, 'init', function() {
            customControl.setMap(map);

            naver.maps.Event.addDOMListener(customControl.getElement(), 'click', function() {
              map.setCenter(new naver.maps.LatLng(latitude, longitude));
            });
          });

        }

      })

    </script>
  </div>
</table>
</body>
</html>